{% extends 'partials/base.html' %}
{% load static %}
{% block title %} اضافة مشروع{% endblock title %}
    {% block page_title %}
{% if project %}
        {% include 'partials/page_title_projects.html' with page_title=project.name sub_title="المشاريع" title="تحديث مشروع" hide="true" %}
{% else %}
   {% include 'partials/page_title_projects.html' with page_title="مشروع جديد" sub_title="المشاريع" title="اضافة مشروع" hide="true" %}
{% endif %}
{% endblock page_title %}

{% block extra_css %}

<style>
    .input-group-prepend ,.input-group-append{
    display:none !important;
    }
    .select2-container--default{
    display:none !important;
    }
    .bootstrap-touchspin-prefix ,.bootstrap-touchspin-postfix{
    display:block !important;
    }

</style>
{% endblock %}
{% block content %}

        <div class="row">
            <div class="col-sm-12">
                <div class="card">
                    <div class="card-body" >
                        <form id="form-horizontal"  class="form-horizontal form-wizard-wrapper custom-validation needs-validation"  method="post" novalidate>
                             {% csrf_token %}
                            <h3>تفاصيل المشروع</h3>
                            <fieldset>
                                <div class="row">
                                    <div class="col-6 row">
                                        <label for="name" class="col-4 col-form-label">ادخل اسم المشروع</label>
                                        <div class="col-8">
                                            <input id="name" name="name_project"  style="width:100%" value="{{project.name}}" type="text" class="form-control " placeholder="ادخل اسم المشروع" required>
                                        </div>
                                    </div>

                                        <div class="col-6 row">
                                            <label for="name" class="col-lg-4 col-form-label">جهة اصدار خطاب الضمان</label>
                                            <div class="col-lg-8">
                                                <input id="name" name="letter_of_guarantee"  value="{{project.letter_of_guarantee}}" type="text" class="form-control" placeholder="ادخل اسم المشروع" required>
                                            </div>
                                            </div>
                                    <div class="col-6 row mb-4">
                                        <label for="name" class="col-lg-4 col-form-label">قيمة التأمين</label>
                                        <div class="col-lg-8">
                                            <input id="total" data-parsley-type="number" class="form-control" type="number" value="{{project.price_project}}"  name="demo2">
                                        </div>
                                        </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="row mb-3">
                                            <label for="date_session" class="col-lg-3 col-form-label">تاريخ الجلسة</label>
                                            <div class="col-lg-9">
                                               <div class="input-group" id="datepicker2">
                                    <input id="date_session" type="text" value="{{project.date_session|date:'d-m-Y'}}" name="date1" class="form-control" placeholder="dd-mm-yyyy"
                                        data-date-format="dd-mm-yyyy" data-date-container='#datepicker2' data-provide="datepicker"
                                        data-date-autoclose="true">
                                    <span class="input-group-text"><i class="mdi mdi-calendar"></i></span>
                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="row mb-3">
                                            <label for="finance" class="col-lg-3 col-form-label">تاريخ فتح مالي</label>
                                            <div class="col-lg-9">
                                                <div class="input-group" id="datepicker3">
                                    <input id="finance" value="{{project.date_finance|date:'d-m-Y'}}" name="date2" type="text" class="form-control" placeholder="dd-mm-yyyy"
                                        data-date-format="dd-mm-yyyy" data-date-container='#datepicker3' data-provide="datepicker"
                                        data-date-autoclose="true">

                                    <span class="input-group-text"><i class="mdi mdi-calendar"></i></span>
                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="row mb-3">
                                            <label for="date3" class="col-lg-3 col-form-label">تاريخ اخطار الترسية</label>
                                            <div class="col-lg-9">
                                               <div class="input-group" id="datepicker4">
                                    <input id="date3" value="{{project.date_notification_Altrsih|date:'d-m-Y'}}" name="date3" type="text" class="form-control" placeholder="dd-mm-yyyy"
                                        data-date-format="dd-mm-yyyy" data-date-container='#datepicker4' data-provide="datepicker"
                                        data-date-autoclose="true">

                                    <span class="input-group-text"><i class="mdi mdi-calendar"></i></span>
                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="row mb-3">
                                            <label for="date4" class="col-lg-3 col-form-label">تاريخ سداد تأمين خطاب الخسمات</label>
                                            <div class="col-lg-9">
                                                <div class="input-group" id="datepicker5">
                                    <input id="date4" value="{{project.date_sadad_khatab_alkhsmat|date:'d-m-Y'}}" name="date4" type="text" class="form-control" placeholder="dd-mm-yyyy"
                                        data-date-format="dd-mm-yyyy" data-date-container='#datepicker5' data-provide="datepicker"
                                        data-date-autoclose="true">

                                    <span class="input-group-text"><i class="mdi mdi-calendar"></i></span>
                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="row mb-3">
                                            <label for="date5" class="col-lg-3 col-form-label">تاريخ امر الاسناد</label>
                                            <div class="col-lg-9">
                                               <div class="input-group" id="datepicker6">
                                    <input id="date5" value="{{project.date_asnad|date:'d-m-Y'}}" name="date5" type="text" class="form-control" placeholder="dd-mm-yyyy"
                                        data-date-format="dd-mm-yyyy" data-date-container='#datepicker6' data-provide="datepicker"
                                        data-date-autoclose="true">

                                    <span class="input-group-text"><i class="mdi mdi-calendar"></i></span>
                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="row mb-3">
                                            <label for="date7" class="col-lg-3 col-form-label">تاريخ امر الشعل</label>
                                            <div class="col-lg-9">
                                                <div class="input-group" id="datepicker7">
                                    <input id="date7" value="{{project.date_work|date:'d-m-Y'}}" name="date6" type="text" class="form-control" placeholder="dd-mm-yyyy"
                                        data-date-format="dd-mm-yyyy" data-date-container='#datepicker7' data-provide="datepicker"
                                        data-date-autoclose="true" readonly>

                                    <span class="input-group-text"><i class="mdi mdi-calendar"></i></span>
                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="row mb-3">
                                            <label for="date8" class="col-lg-3 col-form-label">مدة المشروع (شهر) </label>
                                            <div class="col-lg-9">
                                               <div class="input-group" id="duration">
                                                   {% if project %}
                                                    <input id="data8"   onkeyup="CalculateEnd(this)"  value="{{project.duration_project}}" name="date7" type="number" class="form-control" readonly>

                                                   {% else %}
                                                    <input id="data8"   onkeyup="CalculateEnd(this)"  value="{{project.duration_project}}" name="date7" type="number" class="form-control" required>

                                                   {% endif %}
                                    <span class="input-group-text"><i class="mdi mdi-calendar"></i></span>
                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    {% if project %}
                                    <div class="col-md-6">
                                        <div class="row mb-3">
                                            <label for="date18" class="col-lg-3 col-form-label">مدة اضافية (شهر)</label>
                                            <div class="col-lg-9">
                                               <div class="input-group" id="add_duration">
                                    <input id="date18" value="{{project.date_extra_end}}" name="date8" type="number"  onkeyup="AddDuration(this)" class="form-control">
                                    <span class="input-group-text"><i class="mdi mdi-calendar"></i></span>
                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    {% endif %}
                                    <div class="col-md-6 mx-auto">
                                        <div class="row mb-3">
                                            <label for="date8" class="col-lg-3 col-form-label">تاريخ انتهاء المشروع </label>
                                            <div class="col-lg-9">
                                               <div class="input-group" id="datepicker8">
                                    <input id="date8" value="{{project.date_end|date:'d-m-Y'}}" name="date7" type="text" class="form-control" placeholder="dd-mm-yyyy"
                                        data-date-format="dd-mm-yyyy"   readonly required>

                                    <span class="input-group-text"><i class="mdi mdi-calendar"></i></span>
                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>


                            </fieldset>
                            <h3>القيمة المالية</h3>
                            <fieldset>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="row mb-3">
                                            <label for="total" class="col-lg-3 col-form-label">قيمة المشروع</label>
                                            <div class="col-lg-9">
                                                 <input id="total" data-parsley-type="number" class="form-control" type="number" value="{{project.price_project}}"  name="demo2">
                                            </div>
                                        </div>
                                    </div>
                                    <!-- end col -->
                                    <div class="col-md-6">
                                        <div class="row mb-3">
                                            <label for="demo1" class="col-lg-3 col-form-label">غرامت التأخير</label>

                                            <div class="col-lg-9 ">

                                                <input id="demo1" data-parsley-type="number" class="form-control" type="number" value="{{project.gramat_altakheer}}" name="demo1">

                                            </div>
                                        </div>
                                    </div>
                                    <!-- end col -->
                                </div>
                                <!-- end row -->
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="row mb-3">
                                            <label for="total" class="col-lg-3 col-form-label"> قيمة المشروع المنفذه فعليا</label>
                                            <div class="col-lg-9">
                                                 <input id="total2" data-parsley-type="number" class="form-control" type="number" value="{{project.total_price_end}}" name="demo2">
                                            </div>
                                        </div>

                                </div>
                                    <div class="mb-3">
                                        <label class="form-label" for="report">التقرير</label>
                                        <textarea id="report" name="report" class="form-control"   placeholder="التفاصيل هنا">{{project.report}}</textarea>
                                    </div>

                                </div>
                                <!-- end row -->
                            </fieldset>
                           {% if project %}
                           <h3>المدد الاضافية</h3>
                           <fieldset>
                               <div class="row">
                             <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <h4 class="card-title">الزيادة</h4>
                        <div>
                       
                               <div class="row">
                                   <div  class="mb-3 col-lg-4">
                                       <label class="form-label" for="price_2">تاريخ امر الزيادة</label>
                                        <div class="input-group" id="datepicker100">
                                   <input id="durationDate1" name="dated1" type="text" value="" class="form-control" placeholder="dd-mm-yyyy"
                                       data-date-format="dd-mm-yyyy" data-date-container='#datepicker100' data-provide="datepicker"
                                       data-date-autoclose="true">

                                   <span class="input-group-text"><i class="mdi mdi-calendar"></i></span>
                               </div>
                                   </div>
                                   <div  class="mb-3 col-lg-4">
                                       <label class="form-label" for="price_2">النهو المقرر قبل الزيادة </label>
                                        <div class="input-group" id="datepicker101">
                                   <input id="durationDate2" name="dated2" type="text"  class="form-control" placeholder="dd-mm-yyyy"
                                       data-date-format="dd-mm-yyyy" data-date-container='#datepicker101' data-provide="datepicker"
                                       data-date-autoclose="true">

                                   <span class="input-group-text"><i class="mdi mdi-calendar"></i></span>
                               </div>
                                   </div>
                                   <div  class="mb-3 col-lg-4">
                                       <label class="form-label" for="price_2">النهو بعد الزيادة</label>
                                        <div class="input-group" id="datepicker102">
                                   <input id="durationDate3" name="dated3" type="text" class="form-control" placeholder="dd-mm-yyyy"
                                       data-date-format="dd-mm-yyyy" data-date-container='#datepicker102' data-provide="datepicker"
                                       data-date-autoclose="true">

                                   <span class="input-group-text"><i class="mdi mdi-calendar"></i></span>
                               </div>
                                   </div>
                                   <div  class="mb-3 col-lg-4">
                                       <label class="form-label6" for="price_2">المدة</label>
                                        <input id="duration1" value="" name="moard" type="text"  class=" form-control" readonly>
                                   </div>
                                    <div  class="mb-3 col-lg-5">
                                        <label class="form-label" for="price_">قيمة الزيادة</label>
                                         <input id="duration2" data-parsley-type="number" class="form-control" type="number" value=""  name="demo2">
                                    </div>
                                    <div class="mb-3 col-lg-10">
                                       <label class="form-label" for="message">السبب</label>
                                       <textarea  id="duration3" name="reason" class="form-control" value="" placeholder="التفاصيل هنا"></textarea>
                                   </div>
                                </div>
                                <!-- end row -->
                            <input onclick="addDurations(`{{project.id}}`)" type="button" class="btn btn-success mt-2 mt-sm-0" value="اضافة مدة زيادة"/>
                           
                        
            </div>
        </div>
        <table id="datatable-buttons" class="table table-striped table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
            <thead>
                <tr>
                    <th>تاريخ امر الزيادة</th>
                    <th>النهو المقرر قبل الزيادة</th>
                    <th>النهو بعد الزيادة</th>
                    <th> المدة</th>
                    <th>قيمة الزيادة</th>
                    <th>السبب</th>

                </tr>
            </thead>


            <tbody id="tableDurations">
            {% for du in project.durations.all %}
           <tr>
           
                <td>{{du.date_Period}}</td>
                <td>{{du.terminationBeforeTheIncrease}}</td>
                <td>{{du.terminationAfterTheIncrease}}</td>
                <td>{{du.duration}}</td>
                <td>{{du.price_increase}}</td>
                <td>{{du.reason}}</td>  
           </tr>
            {% endfor %}
            </tbody>
        </table>
                            </fieldset>
                           {% endif %}
                           {% if project %}
                           <h3>مصروفات وتحويلات الموردين</h3>
                           <fieldset>
                               <div class="row">
                             <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <h4 class="card-title">المصروفات</h4>
                        <div>
                       
                               <div class="row">

                                <div class="mb-3 col-lg-5">
                                    <label class="form-label">اختر العميل </label>
                                     <select class="form-control select2" id="impSelect">
                                    {% for engineer in importeds %}
                                          <option value="{{engineer.id}}">{{engineer.company_name}}</option>
                                     {% endfor %}
                                 </select>
                                </div>
                                <div  class="mb-3 col-lg-5">
                                    <label class="form-label" for="price_">قيمة المصروف</label>
                                     <input id="impCost" data-parsley-type="number" class="form-control" type="number" value=""  name="demo2">
                                </div>
                                   <div  class="mb-3 col-lg-4">
                                       <label class="form-label" for="price_2">تاريخ المصروف</label>
                                        <div class="input-group" id="datepicker1000">
                                   <input id="impDate" name="dated1" type="text" value="" class="form-control" placeholder="dd-mm-yyyy"
                                       data-date-format="dd-mm-yyyy" data-date-container='#datepicker1000' data-provide="datepicker"
                                       data-date-autoclose="true">

                                   <span class="input-group-text"><i class="mdi mdi-calendar"></i></span>
                               </div>
                                   </div> 
                                    <div class="mb-3 col-lg-10">
                                       <label class="form-label" for="message">ملاحظات</label>
                                       <textarea  id="impNote" name="reason" class="form-control" value="" placeholder="التفاصيل هنا"></textarea>
                                   </div>
                                </div>
                                <!-- end row -->
                            <input onclick="addImported(`{{project.id}}`)" type="button" class="btn btn-success mt-2 mt-sm-0" value="اضافة مدة زيادة"/>
                           
                        
            </div>
        </div>
        <table id="datatable-buttons" class="table table-striped table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
            <thead>
                <tr>
                    <th>العميل</th>
                    <th>التكلفة</th>
                    <th>التاريخ</th>
                    <th> الملاحظات</th>
                  

                </tr>
            </thead>


            <tbody id="tableImp">
            {% for du in project.costs_importeds.all %}
           <tr>
                <td>{{du.imported.company_name}}</td>
                <td>{{du.cost}}</td>
                <td>{{du.date}}</td>
                <td>{{du.note}}</td>
               
           </tr>
            {% endfor %}
            </tbody>
        </table>
                            </fieldset>
                           {% endif %}
                            <h3>مصاريف وعهدة</h3>
                            <fieldset>
                               <div class="row">
                             <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <h4 class="card-title">عهدة</h4>
                        <div class="repeater">
                            {% if project.ahdaa.all %}
                             <div data-repeater-list="group-a">
                            {% for ah in project.ahdaa.all %}

                                <div class="row" data-repeater-item>
                                    <div  class="mb-3 col-lg-5">
<!--                                        <label class="form-label" for="name_m_">اسم العهدة</label>-->
<!--                                        <input type="text" id="name_m_" value="{{ah.name}}" name="untyped-input" class="form-control" placeholder="ادخل اسم العهدة"/>-->
                                   <label class="form-label">اختر مهندس </label>
                                    <select class="form-control select2" name="engineer">
<!--                                    <option>{{ah.engineer_id.name}}</option>-->
                                   {% for engineer in engineers %}
                                    {% if ah.engineer_id.id == engineer.id %}
                                         <option value="{{engineer.id}}" selected>{{engineer.name}}</option>
                                        {% else %}
                                         <option value="{{engineer.id}}">{{engineer.name}}</option>
                                        {%endif%}
                                    {% endfor %}
                                </select>
                                    </div>
                                    <div  class="mb-3 col-lg-5">
                                        <label class="form-label" for="price_">قيمة العهدة</label>
                                         <input id="price_" data-parsley-type="number" class="form-control" type="number" value="{{ah.price}}"  name="demo2">
                                    </div>
                                    <div class="col-lg-2 col-sm-4 align-self-center">
                                        <div class="d-grid">
                                            <input data-repeater-delete type="button" class="btn btn-primary mb-2" value="مسح العهدة"/>
                                        </div>
                                    </div>
                                    <!-- end col -->
                                </div>
                                <!-- end row -->

                            {% endfor %}
                                  </div>
                            {% else %}
                              <div data-repeater-list="group-a">
                                <div class="row" data-repeater-item>
                                    <div  class="mb-3 col-lg-5">
<!--                                        <label class="form-label" for="name_m">اسم العهدة</label>-->
<!--                                        <input type="text" id="name_m" name="untyped-input" class="form-control" placeholder="ادخل اسم العهدة"/>-->
                                    <label class="form-label">اختر مهندس </label>
                                <select class="form-control select2" name="engineer">
                                   {% for engineer in engineers %}
                                     <option value="{{engineer.id}}">{{engineer.name}}</option>
                                    {% endfor %}
                                </select>
                                    </div>
                                    <div  class="mb-3 col-lg-5">
                                        <label class="form-label" for="price">قيمة العهدة</label>
                                        <input id="price" data-parsley-type="number" class="form-control" type="number" value="0" name="demo2">

                                    </div>
                                    <div class="col-lg-2 col-sm-4 align-self-center">
                                        <div class="d-grid">
                                            <input data-repeater-delete type="button" class="btn btn-primary mb-2" value="مسح العهدة"/>
                                        </div>
                                    </div>
                                    <!-- end col -->
                                </div>
                                <!-- end row -->
                            </div>
                            {% endif %}

                            <input data-repeater-create type="button" class="btn btn-success mt-2 mt-sm-0" value="اضافة عهدة اخري"/>
                        <div>
                    </div>
                </div>
            </div>
                                     </div>
                                <div class="row">
                             <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <h4 class="card-title">مصروفات</h4>
                           <div class="repeater">
                                <div data-repeater-list="group-a">
                               {% if project.masourfats.all %}
                                    {% for mo in project.masourfats.all %}
                                     <div class="row" data-repeater-item>
                                    <div  class="mb-3 col-lg-4">
                                        <label class="form-label" for="price_2_">قيمة المصروف</label>

                                         <input id="price_2_" data-parsley-type="number" class="form-control" type="number"  value="{{mo.price}}" name="demo2">

                                    </div>
                                    <div  class="mb-3 col-lg-4">
                                        <label class="form-label" for="price_2">تاريخ المصروف</label>
                                         <div class="input-group" id="datepicker100">
                                    <input id="date_price3" name="date10" type="text" value="{{mo.date_masrouf|date:'d-m-Y'}}" class="form-control" placeholder="dd-mm-yyyy"
                                        data-date-format="dd-mm-yyyy" data-date-container='#datepicker100' data-provide="datepicker"
                                        data-date-autoclose="true">

                                    <span class="input-group-text"><i class="mdi mdi-calendar"></i></span>
                                </div>
                                    </div>
                                    <div  class="mb-3 col-lg-4">
                                        <select class="form-control select2" name="imported_">
                                            {% for im in importeds %}
                                            {% if mo.imported.id == im.id %}
                                                 <option value="{{im.id}}" selected>{{im.company_name}}</option>
                                                {% else %}
                                                 <option value="{{im.id}}">{{im.company_name}}</option>
                                                {%endif%}
                                            {% endfor %}
                                        </select>
                                        <label class="form-label6" for="price_2">الموردين</label>
                                         <!--<input id="almordeen6" value="{{mo.almardeen}}" name="moard" type="text"  class=" form-control"> -->
                                    </div>
                                          <div  class="mb-3 col-lg-4">
                                          <label class="form-label"> بيان المصروف </label>
                                <select class="form-control select2" name="engineer_">
                                    {% for engineer in engineers %}
                                    {% if mo.bain_masrouf.id == engineer.id %}
                                         <option value="{{engineer.id}}" selected>{{engineer.name}}</option>
                                        {% else %}
                                         <option value="{{engineer.id}}">{{engineer.name}}</option>
                                        {%endif%}
                                    {% endfor %}
                                </select>
                                          </div>
                                    <div class="mb-3 col-lg-6 ">
                                        <label class="form-label" for="message">التفاصيل</label>
                                        <input  name="des" class="form-control" value="{{mo.descriptions}}" placeholder="التفاصيل هنا"/>
                                    </div>
                                    <!-- end col -->
                                    <div class="col-lg-2 col-sm-4 align-self-center">
                                        <div class="d-grid">
                                            <input data-repeater-delete type="button" class="btn btn-primary mb-2" value="مسح مصروف"/>
                                        </div>
                                    </div>
                                    <!-- end col -->
                                </div>
                                    {% endfor %}
                                    {% else %}
                                     <div class="row" data-repeater-item>
                                    <div  class="mb-3 col-lg-4">
                                        <label class="form-label" for="price_2">قيمة المصروف</label>
                                        <input id="price_2" data-parsley-type="number" class="form-control" type="number" value="0" name="demo2">

                                    </div>
                                    <div  class="mb-3 col-lg-4">
                                        <label class="form-label" for="price_2">تاريخ المصروف</label>
                                         <div class="input-group" id="datepicker10">
                                    <input id="date_price" name="date10" type="text" class="form-control" placeholder="dd-mm-yyyy"
                                        data-date-format="dd-mm-yyyy" data-date-container='#datepicker10' data-provide="datepicker"
                                        data-date-autoclose="true">

                                    <span class="input-group-text"><i class="mdi mdi-calendar"></i></span>
                                </div>
                                    </div>
                                    <div  class="mb-3 col-lg-4">
                                        <label class="form-label" for="price_2">الموردين</label>
                                        <select class="form-control select2" name="imported_">
                                            {% for im in importeds %}
                                            
                                                 <option value="{{im.id}}">{{im.company_name}}</option>
                                                
                                            {% endfor %}
                                        </select>
                                    </div>
                                          <div  class="mb-3 col-lg-4">
                                          <label class="form-label">بيان المصروف</label>
                                <select class="form-control select2" name="engineer_">
                                   {% for engineer in engineers %}
                                     <option value="{{engineer.id}}">{{engineer.name}}</option>
                                    {% endfor %}
                                </select>
                                          </div>
                                    <div class="mb-3 col-lg-6 ">
                                        <label class="form-label" for="message">التفاصيل</label>
                                        <textarea id="message" name="des" class="form-control" placeholder="التفاصيل هنا"></textarea>
                                    </div>
                                    <!-- end col -->
                                    <div class="col-lg-2 col-sm-4 align-self-center">
                                        <div class="d-grid">
                                            <input data-repeater-delete type="button" class="btn btn-primary mb-2" value="مسح مصروف"/>
                                        </div>
                                    </div>
                                    <!-- end col -->
                                </div>
                                    {% endif %}
                                <!-- end row -->
                            </div>
                            <input data-repeater-create type="button" class="btn btn-success mt-2 mt-sm-0" value="اضافة مصروف اخر"/>

                           </div>
                    </div>
                </div>
                             </div>
                </div>
            </div>
                                     </div>
                            </fieldset>

                            <h3> المستخلصات</h3>
                            <fieldset>
                                <div class="p-3">
                                     <div class="card">
                    <div class="card-body">
                        <h4 class="card-title">المستخلصات</h4>
                        <div class="repeater">
                            {% if project.mostakhlas.all %}
                             <div data-repeater-list="group-c">
                            {% for ah in project.mostakhlas.all %}

                                <div class="row" data-repeater-item>
                                    <div class="row">
                                    <div class="col-md-6">

                                        <div class="row mb-3">
                                             <label for="name_mo" class="col-lg-3 col-form-label">اختر مهندس</label>
                                            <div class="col-lg-9 ">
                                            <select class="form-control select2" name="engineer">
<!--                                    <option>{{ah.engineer_id.name}}</option>-->
                                   {% for engineer in engineers %}
                                    {% if ah.engineer_id.id == engineer.id %}
                                         <option value="{{engineer.id}}" selected>{{engineer.name}}</option>
                                        {% else %}
                                         <option value="{{engineer.id}}">{{engineer.name}}</option>
                                        {%endif%}
                                    {% endfor %}
                                </select>
                                            </div>
                                        </div>
                                    </div>
                                        <div class="col-md-6">
                                        <div class="row mb-3">
                                            <label for="name_mo" class="col-lg-3 col-form-label"> قيمة المستخلص الفعلية</label>
                                           <div class="col-lg-9 ">
                                                  <input  data-parsley-type="number" onkeyup="mostakhlas(this)"  class="form-control actual_extract_value" type="text" value="{{ah.actual_extract_value}}"  name="demo2">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="row mb-3">
                                            <label for="date_session" class="col-lg-3 col-form-label">تاريخ المستخلص</label>
                                            <div class="col-lg-9">
                                               <div class="input-group" id="datepicker11">
                                    <input id="date_mo" type="text" value="{{ah.date_mostakhlas|date:'d-m-Y'}}" name="date_mo" class="form-control" placeholder="dd-mm-yyyy"
                                        data-date-format="dd-mm-yyyy" data-date-container='#datepicker11' data-provide="datepicker"
                                        data-date-autoclose="true">

                                    <span class="input-group-text"><i class="mdi mdi-calendar"></i></span>
                                </div>
                                            </div>
                                        </div>
                                    </div>

                                     <div class="col-md-6">
                                        <div class="row mb-3">
                                             <label for="demo1" class="col-lg-3 col-form-label">التأميناتٍ</label>

                                            <div class="col-lg-9 ">

                                                <input id="demo1" data-parsley-type="number" onkeyup="mostakhlas(this)" class="form-control altaminat" type="text" value="{{ah.altaminat}}" name="demo1">

                                            </div>
                                        </div>
                                    </div>

                                </div>

                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="row mb-3">
                                             <label for="demo1" class="col-lg-3 col-form-label">القوه العاملة</label>

                                            <div class="col-lg-9 ">

                                                <input id="demo1" data-parsley-type="number" onkeyup="mostakhlas(this)"  class="form-control workforce" type="text" value="{{ah.workforce}}" name="demo1">

                                            </div>
                                        </div>
                                    </div>

                                     <div class="col-md-6">
                                        <div class="row mb-3">
                                             <label for="demo1" class="col-lg-3 col-form-label">تسبة خصم الجمعية</label>

                                            <div class="col-lg-9 ">

                                                <input id="demo1" data-parsley-type="number" onkeyup="mostakhlas(this)"  class="form-control Combined_discount_rate" type="text" value="{{ah.Combined_discount_rate}}" name="demo1">

                                            </div>
                                        </div>
                                    </div>

                                </div>
                                        <div class="row">
                                    <div class="col-md-6">
                                        <div class="row mb-3">
                                             <label for="demo1" class="col-lg-3 col-form-label">نسبة البنك </label>

                                            <div class="col-lg-9 ">

                                                <input id="demo1" data-parsley-type="number"  onkeyup="mostakhlas(this)" class="form-control bank_ratio" type="text" value="{{ah.bank_ratio}}" name="demo1">

                                            </div>
                                        </div>
                                    </div>

                                     <div class="col-md-6">
                                        <div class="row mb-3">
                                             <label for="demo1" class="col-lg-3 col-form-label">تسبة الدمغة الهندسية </label>

                                            <div class="col-lg-9 ">

                                                <input id="demo1" data-parsley-type="number"  onkeyup="mostakhlas(this)" class="form-control engineering_stamp" type="text " value="{{ah.engineering_stamp}}" name="demo1">

                                            </div>
                                        </div>
                                    </div>

                                </div>
                                         <div class="row">
                                    <div class="col-md-6">
                                        <div class="row mb-3">
                                             <label for="demo1" class="col-lg-3 col-form-label">ضمان الاعمال </label>

                                            <div class="col-lg-9 ">

                                                <input id="demo1" data-parsley-type="number" onkeyup="mostakhlas(this)" class="form-control others" type="text" value="{{ah.others}}" name="demo1">

                                            </div>
                                        </div>
                                    </div>

                                     <div class="col-md-6">
                                        <div class="row mb-3">
                                             <label for="demo1" class="col-lg-3 col-form-label">والضرائب</label>
                                            <div class="col-lg-9 ">
                                                <input id="demo1" data-parsley-type="number" value="{{ah.taxes}}" onkeyup="mostakhlas(this)" class="form-control taxes" type="text"  name="demo1">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-6">
                                        <div class="row mb-3">
                                             <label for="demo1" class="col-lg-3 col-form-label">استقطاعات اخري1</label>

                                            <div class="col-lg-9 ">

                                                <input id="demo1" data-parsley-type="number" onkeyup="mostakhlas(this)"  class="form-control other_deductions_1" type="text" value="{{ah.other_deductions_1}}"  name="demo1">



                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-6">
                                        <div class="row mb-3">
                                             <label for="demo1" class="col-lg-3 col-form-label">استقطاعات اخري2</label>

                                            <div class="col-lg-9 ">

                                                <input id="demo1" data-parsley-type="number" onkeyup="mostakhlas(this)"  class="form-control other_deductions_2" type="text" value="{{ah.other_deductions_2}}"   name="demo1">



                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-6">
                                        <div class="row mb-3">
                                             <label for="demo1" class="col-lg-3 col-form-label">ضريبة ارباح تجارية وصناعية</label>

                                            <div class="col-lg-9 ">

                                                <input id="demo1" data-parsley-type="number" onkeyup="mostakhlas(this)"  class="form-control commercial_ndustrial_profits_tax" type="text"  value="{{ah.commercial_ndustrial_profits_tax}}"  name="demo1">



                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="row mb-3">
                                             <label for="demo1" class="col-lg-3 col-form-label">ضريبة القيمة المضافة</label>

                                            <div class="col-lg-9 ">

                                                <input id="demo1" data-parsley-type="number" onkeyup="mostakhlas(this)"  class="form-control value_added_tax" type="text" value="{{ah.value_added_tax}}"  name="demo1">



                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="row mb-3">
                                             <label for="demo1" class="col-lg-3 col-form-label">ضريبة شعبة الدمغة</label>

                                            <div class="col-lg-9 ">

                                                <input id="demo1" data-parsley-type="number" onkeyup="mostakhlas(this)"  class="form-control stamp_tax_division" type="text" value="{{ah.stamp_tax_division}}"  name="demo1">



                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="row mb-3">
                                             <label for="demo1" class="col-lg-3 col-form-label">صندوق تكريم الشهداء</label>

                                            <div class="col-lg-9 ">

                                                <input id="demo1" data-parsley-type="number" onkeyup="mostakhlas(this)"  class="form-control martyrs_Honor_fund" type="text"  name="demo1" value="{{ah.martyrs_Honor_fund}}">



                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="row mb-3">
                                             <label for="demo1" class="col-lg-3 col-form-label">ضريبة تنمية الموارد</label>

                                            <div class="col-lg-9 ">

                                                <input id="demo1" data-parsley-type="number" onkeyup="mostakhlas(this)"  class="form-control resource_development_tax" type="text"  name="demo1" value="{{ah.resource_development_tax}}">



                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="row mb-3">
                                             <label for="demo1" class="col-lg-3 col-form-label">1% صندوق تحي مصر </label>

                                            <div class="col-lg-9 ">

                                                <input id="demo1" data-parsley-type="number" onkeyup="mostakhlas(this)"  class="form-control long_Live_egypt_fund" type="text"  name="demo1" value="{{ah.long_Live_egypt_fund}}">



                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="row mb-3">
                                             <label for="demo1" class="col-lg-3 col-form-label">دمغة تطبيقية</label>

                                            <div class="col-lg-9 ">

                                                <input id="demo1" data-parsley-type="number" onkeyup="mostakhlas(this)"  class="form-control applied_tear" type="text"  name="demo1" value="{{ah.applied_tear}}">



                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="row mb-3">
                                             <label for="demo1" class="col-lg-3 col-form-label">اتحاد مقاولين</label>

                                            <div class="col-lg-9 ">

                                                <input id="demo1" data-parsley-type="number" onkeyup="mostakhlas(this)"  class="form-control union_of_two_sayings" type="text"  name="demo1" value="{{ah.union_of_two_sayings}}">



                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="row mb-3">
                                             

                                            <div class="col-lg-12 ">

                                                <textarea  placeholder="الملاحظات"  class="form-control taxes" type="text"  name="notes">{{ah.notes}}</textarea>



                                            </div>
                                        </div>
                                    </div>

                                </div>
                                        <div class="row">
                                    <div class="col-md-6">
                                        <div class="row mb-3">
                                             <label for="demo1" class="col-lg-3 col-form-label">قيمة المستخلص بعد الخصم </label>

                                            <div class="col-lg-9 ">

                                                  <input id="total" data-parsley-type="number" class="form-control price_mostakhlas_after" type="txt" value="{{ah.price_mostakhlas_after}}"  name="demo2" readonly>

                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="row mb-3">
                                             <label for="demo1" class="col-lg-3 col-form-label">قيمة الخصم  </label>

                                            <div class="col-lg-9 ">

                                                  <input id="discount" data-parsley-type="number" class="form-control discount" type="text" value="{{ah.discount}}"  name="demo2" readonly>

                                            </div>
                                        </div>
                                    </div>

                                </div>
                                     <div class="row" dir="ltr">
                                              <div class="col-md-6">
                                        <input data-repeater-delete type="button" class="btn btn-primary mb-2 float-end w-75" value="مسح المستخلص"/>
                                    </div>
                                </div>
                                <!-- end row -->

                            {% endfor %}
                                  </div>
                            {% else %}
                              <div data-repeater-list="group-c">
                                    <div class="row" data-repeater-item>
                                    <div class="row">
                                    <div class="col-md-6">
                                        <div class="row mb-3">
                                             <label for="name_mo" class="col-lg-3 col-form-label">اختر مهندس</label>
                                            <div class="col-lg-9 ">
                                    <select class="form-control select2" name="engineer">

                                   {% for engineer in engineers %}
                                         <option value="{{engineer.id}}">{{engineer.name}}</option>
                                    {% endfor %}
                                </select>
                                             </div>
                                        </div>
                                    </div>
                                        <div class="col-md-6">
                                        <div class="row mb-3">
                                            <label for="name_mo" class="col-lg-3 col-form-label">قيمة المستخلص الفعلية</label>
                                           <div class="col-lg-9 ">
                                                  <input  data-parsley-type="number" onkeyup="mostakhlas(this)" class="form-control actual_extract_value" type="text" value=""  name="demo2">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="row mb-3">
                                            <label for="date_session" class="col-lg-3 col-form-label">تاريخ المستخلص</label>
                                            <div class="col-lg-9">
                                               <div class="input-group" id="datepicker11">
                                    <input id="date_mo" type="text" value="" name="date_mo" class="form-control" placeholder="dd-mm-yyyy"
                                        data-date-format="dd-mm-yyyy" data-date-container='#datepicker11' data-provide="datepicker"
                                        data-date-autoclose="true">

                                    <span class="input-group-text"><i class="mdi mdi-calendar"></i></span>
                                </div>
                                            </div>
                                        </div>
                                    </div>

                                     <div class="col-md-6">
                                        <div class="row mb-3">
                                             <label for="demo1" class="col-lg-3 col-form-label">التأميناتٍ</label>

                                            <div class="col-lg-9 ">

                                                <input id="demo1" data-parsley-type="number"  onkeyup="mostakhlas(this)"  class="form-control altaminat" type="text" value="" name="demo1">

                                            </div>
                                        </div>
                                    </div>

                                </div>

                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="row mb-3">
                                             <label for="demo1" class="col-lg-3 col-form-label">القوه العاملة</label>

                                            <div class="col-lg-9 ">

                                                <input id="demo1" data-parsley-type="number" onkeyup="mostakhlas(this)"  class="form-control workforce" type="text" value="{{project.gramat_altakheer}}" name="demo1">

                                            </div>
                                        </div>
                                    </div>

                                     <div class="col-md-6">
                                        <div class="row mb-3">
                                             <label for="demo1" class="col-lg-3 col-form-label">تسبة خصم الجمعية</label>

                                            <div class="col-lg-9 ">

                                                <input id="demo1" data-parsley-type="number" onkeyup="mostakhlas(this)"  class="form-control Combined_discount_rate" type="text" value="{{project.gramat_altakheer}}" name="demo1">

                                            </div>
                                        </div>
                                    </div>

                                </div>
                                        <div class="row">
                                    <div class="col-md-6">
                                        <div class="row mb-3">
                                             <label for="demo1" class="col-lg-3 col-form-label">نسبة البنك </label>

                                            <div class="col-lg-9 ">

                                                <input id="demo1" data-parsley-type="number" onkeyup="mostakhlas(this)"  class="form-control bank_ratio" type="text" value="{{project.gramat_altakheer}}" name="demo1">

                                            </div>
                                        </div>
                                    </div>

                                     <div class="col-md-6">
                                        <div class="row mb-3">
                                             <label for="demo1" class="col-lg-3 col-form-label">تسبة الدمغة الهندسية </label>

                                            <div class="col-lg-9 ">

                                                <input id="demo1" data-parsley-type="number" onkeyup="mostakhlas(this)"  class="form-control engineering_stamp" type="text" value="{{project.gramat_altakheer}}" name="demo1">

                                            </div>
                                        </div>
                                    </div>

                                </div>
                                         <div class="row">
                                    <div class="col-md-6">
                                        <div class="row mb-3">
                                             <label for="demo1" class="col-lg-3 col-form-label">ضمان الاعمال </label>

                                            <div class="col-lg-9 ">

                                                <input id="demo1" data-parsley-type="number" onkeyup="mostakhlas(this)"  class="form-control others" type="text" name="demo1">

                                            </div>
                                        </div>
                                    </div>

                                     <div class="col-md-6">
                                        <div class="row mb-3">
                                             <label for="demo1" class="col-lg-3 col-form-label">والضرائب</label>

                                            <div class="col-lg-9 ">

                                                <input id="demo1" data-parsley-type="number" onkeyup="mostakhlas(this)"  class="form-control taxes" type="text"  name="demo1">



                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-6">
                                        <div class="row mb-3">
                                             <label for="demo1" class="col-lg-3 col-form-label">استقطاعات اخري1</label>

                                            <div class="col-lg-9 ">

                                                <input id="demo1" data-parsley-type="number" onkeyup="mostakhlas(this)"  class="form-control other_deductions_1" type="text"  name="demo1">



                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-6">
                                        <div class="row mb-3">
                                             <label for="demo1" class="col-lg-3 col-form-label">استقطاعات اخري2</label>

                                            <div class="col-lg-9 ">

                                                <input id="demo1" data-parsley-type="number" onkeyup="mostakhlas(this)"  class="form-control other_deductions_2" type="text"  name="demo1">



                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-6">
                                        <div class="row mb-3">
                                             <label for="demo1" class="col-lg-3 col-form-label">ضريبة ارباح تجارية وصناعية</label>

                                            <div class="col-lg-9 ">

                                                <input id="demo1" data-parsley-type="number" onkeyup="mostakhlas(this)"  class="form-control commercial_ndustrial_profits_tax" type="text"  name="demo1">



                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="row mb-3">
                                             <label for="demo1" class="col-lg-3 col-form-label">ضريبة القيمة المضافة</label>

                                            <div class="col-lg-9 ">

                                                <input id="demo1" data-parsley-type="number" onkeyup="mostakhlas(this)"  class="form-control value_added_tax" type="text"  name="demo1">



                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="row mb-3">
                                             <label for="demo1" class="col-lg-3 col-form-label">ضريبة شعبة الدمغة</label>

                                            <div class="col-lg-9 ">

                                                <input id="demo1" data-parsley-type="number" onkeyup="mostakhlas(this)"  class="form-control stamp_tax_division" type="text"  name="demo1">



                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="row mb-3">
                                             <label for="demo1" class="col-lg-3 col-form-label">صندوق تكريم الشهداء</label>

                                            <div class="col-lg-9 ">

                                                <input id="demo1" data-parsley-type="number" onkeyup="mostakhlas(this)"  class="form-control martyrs_Honor_fund" type="text"  name="demo1">



                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="row mb-3">
                                             <label for="demo1" class="col-lg-3 col-form-label">ضريبة تنمية الموارد</label>

                                            <div class="col-lg-9 ">

                                                <input id="demo1" data-parsley-type="number" onkeyup="mostakhlas(this)"  class="form-control resource_development_tax" type="text"  name="demo1">



                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="row mb-3">
                                             <label for="demo1" class="col-lg-3 col-form-label">1% صندوق تحي مصر </label>

                                            <div class="col-lg-9 ">

                                                <input id="demo1" data-parsley-type="number" onkeyup="mostakhlas(this)"  class="form-control long_Live_egypt_fund" type="text"  name="demo1">



                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="row mb-3">
                                             <label for="demo1" class="col-lg-3 col-form-label">دمغة تطبيقية</label>

                                            <div class="col-lg-9 ">

                                                <input id="demo1" data-parsley-type="number" onkeyup="mostakhlas(this)"  class="form-control applied_tear" type="text"  name="demo1">



                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="row mb-3">
                                             <label for="demo1" class="col-lg-3 col-form-label">اتحاد مقاولين</label>

                                            <div class="col-lg-9 ">

                                                <input id="demo1" data-parsley-type="number" onkeyup="mostakhlas(this)"  class="form-control union_of_two_sayings" type="text"  name="demo1">



                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="row mb-3">
                                             

                                            <div class="col-lg-12 ">

                                                <textarea  placeholder="الملاحظات"  class="form-control taxes" type="text"  name="notes"></textarea>



                                            </div>
                                        </div>
                                    </div>

                                </div>
                                        <div class="row">
                                    <div class="col-md-6">
                                        <div class="row mb-3">
                                             <label for="demo1" class="col-lg-3 col-form-label">قيمة المستخلص بعد الخصم </label>

                                            <div class="col-lg-9 ">

                                                  <input id="total" data-parsley-type="number" class="form-control price_mostakhlas_after" type="text" value=""  name="demo2" readonly>

                                            </div>
                                        </div>
                                    </div>

                                             <div class="col-md-6">
                                        <div class="row mb-3">
                                             <label for="demo1" class="col-lg-3 col-form-label">قيمة المستخلص بعد الخصم </label>

                                            <div class="col-lg-9 ">

                                                  <input id="discount" data-parsley-type="number" class="form-control discount" type="text" value=""  name="demo2" readonly>

                                            </div>
                                        </div>
                                    </div>



                                </div>
                                        <div class="row" dir="ltr">
                                              <div class="col-md-6">
                                        <input data-repeater-delete type="button" class="btn btn-primary mb-2 float-end w-75" value="مسح المستخلص"/>
                                    </div>
                                        </div>
                                </div>
                                <!-- end row -->
                            </div>
                            {% endif %}



                            <input data-repeater-create type="button" class="btn btn-success mt-2 mt-sm-0 col-4" value="اضافة مستخلص  اخر"/>

     <div>
                    </div>
                </div>
            </div>
                                     </div>




                                    <button class="btn btn-primary w-100">
                                        {% if project %}
                                        تحديث
                                        {%else%}
                                        حفظ
                                        {% endif %}
                                    </button>
                                </div>
                            </fieldset>
                        </form>
                    </div>
                </div>
            </div>
        </div>
{% endblock content %}
{% block extra_js %}
    <script src="{% static 'libs/jquery-steps/build/jquery.steps.min.js'%}"></script>
    <script src="{% static 'js/pages/form-wizard.init.js'%}"></script>
    <script src="{% static 'libs/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js'%}"></script>
    <script src="{% static 'libs/select2/dist/js/select2.min.js'%}"></script>
    <script src="{% static 'libs/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js'%}"></script>
    <script src="{% static 'libs/spectrum-colorpicker2/dist/spectrum.min.js'%}"></script>
    <script src="{% static 'libs/bootstrap-touchspin/dist/jquery.bootstrap-touchspin.min.js'%}"></script>
    <script src="{% static 'libs/admin-resources/bootstrap-filestyle/bootstrap-filestyle.min.js'%}"></script>
    <script src="{% static 'libs/bootstrap-maxlength/dist/bootstrap-maxlength.min.js'%}"></script>
    <script src="{% static 'js/pages/form-advanced.init.js'%}"></script>
    <script src="{% static 'libs/jquery.repeater/jquery.repeater.min.js'%}"></script>
    <script src="{% static 'js/pages/form-repeater.int.js'%}"></script>
    <script src="{% static  'libs/parsleyjs/dist/parsley.min.js'%}"></script>
    <script src="{% static 'js/pages/form-validation.init.js'%}"></script>
<script>
var endProject=document.getElementById("date8");
function AddDuration(event){
var durationProject=document.getElementById("data8");
var addDur=document.getElementById("date18");
if(durationProject.value==""){
alert("يجب ادخال مدة المشروع اولا")
addDur.value="";
}else{
var inputDateStr = endProject.value;
var monthsToAdd = event.value;
addDurationToEnd(inputDateStr,monthsToAdd)
}
}

function CalculateEnd(event){
var startProject=document.getElementById("date7");
var durationProject=document.getElementById("data8");
    if(startProject.value==""){
    alert('ادخل امر الشغل اولا');
durationProject.value="";
    }else{

var inputDateStr = startProject.value;
var monthsToAdd = event.value;

addDurationToEnd(inputDateStr,monthsToAdd)


    }



}
function addDurationToEnd(inputDateStr,monthsToAdd){
var endProject=document.getElementById("date8");
var parts = inputDateStr.split("-");
var day = parseInt(parts[0]);
var month = parseInt(parts[1]);
var year = parseInt(parts[2]);

var inputDate = new Date(year, month - 1, day);

inputDate.setMonth(inputDate.getMonth() + Number(monthsToAdd));

var newDay = inputDate.getDate();
var newMonth = inputDate.getMonth() + 1;
var newYear = inputDate.getFullYear();

var newDateStr = newDay + "-" + newMonth + "-" + newYear;

endProject.value= newDateStr;
}

function mostakhlas(event){
const actual_extract_values=document.getElementsByClassName('actual_extract_value');
const altaminats=document.getElementsByClassName('altaminat');
const workforces=document.getElementsByClassName('workforce');
const Combined_discount_rates=document.getElementsByClassName('Combined_discount_rate');
const bank_ratios=document.getElementsByClassName('bank_ratio');
const engineering_stamps=document.getElementsByClassName('engineering_stamp');
const others=document.getElementsByClassName('others');
const taxes=document.getElementsByClassName('taxes');
const discount=document.getElementsByClassName('discount');
const price_mostakhlas_afters=document.getElementsByClassName('price_mostakhlas_after');
const other_deductions_1=document.getElementsByClassName('other_deductions_1');
const other_deductions_2=document.getElementsByClassName('other_deductions_2');
const commercial_ndustrial_profits_tax=document.getElementsByClassName('commercial_ndustrial_profits_tax');
const value_added_tax=document.getElementsByClassName('value_added_tax');
const stamp_tax_division=document.getElementsByClassName('stamp_tax_division');
const martyrs_Honor_fund=document.getElementsByClassName('martyrs_Honor_fund');
const resource_development_tax=document.getElementsByClassName('resource_development_tax');
const long_Live_egypt_fund=document.getElementsByClassName('long_Live_egypt_fund');
const applied_tear=document.getElementsByClassName('applied_tear');
const union_of_two_sayings=document.getElementsByClassName('union_of_two_sayings');

var index=-1
for(var i=0;i<actual_extract_values.length;i++)
    {
    if(actual_extract_values[i]==event)
    {
    index=i;
    break;
    }
    }
    if(index==-1){
    for(var i=0;i<altaminats.length;i++)
    {
    if(altaminats[i]==event)
    {
    index=i;
    break;
    }
    }
    }

     if(index==-1){
    for(var i=0;i<workforces.length;i++)
    {
    if(workforces[i]==event)
    {
    index=i;
    break;
    }
    }
    }

    if(index==-1){
    for(var i=0;i<Combined_discount_rates.length;i++)
    {
    if(Combined_discount_rates[i]==event)
    {
    index=i;
    break;
    }
    }
    }
    if(index==-1){
    for(var i=0;i<bank_ratios.length;i++)
    {
    if(bank_ratios[i]==event)
    {
    index=i;
    break;
    }
    }
    }
    if(index==-1){
    for(var i=0;i<engineering_stamps.length;i++)
    {
    if(engineering_stamps[i]==event)
    {
    index=i;
    break;
    }
    }
    }
    if(index==-1){
    for(var i=0;i<others.length;i++)
    {
    if(others[i]==event)
    {
    index=i;
    break;
    }
    }
    }

  
if(index==-1){
    for(var i=0;i<taxes.length;i++)
    {
    if(taxes[i]==event)
    {
    index=i;
    break;
    }
    }
    }
    if(index==-1){
    for(var i=0;i<other_deductions_1.length;i++)
    {
    if(other_deductions_1[i]==event)
    {
    index=i;
    break;
    }
    }
    } 
    if(index==-1){
    for(var i=0;i<other_deductions_2.length;i++)
    {
    if(other_deductions_2[i]==event)
    {
    index=i;
    break;
    }
    }
    } 
    if(index==-1){
    for(var i=0;i<commercial_ndustrial_profits_tax.length;i++)
    {
    if(commercial_ndustrial_profits_tax[i]==event)
    {
    index=i;
    break;
    }
    }
    } 
    if(index==-1){
    for(var i=0;i<value_added_tax.length;i++)
    {
    if(value_added_tax[i]==event)
    {
    index=i;
    break;
    }
    }
    } 
    if(index==-1){
    for(var i=0;i<stamp_tax_division.length;i++)
    {
    if(stamp_tax_division[i]==event)
    {
    index=i;
    break;
    }
    }
    } 
    if(index==-1){
    for(var i=0;i<martyrs_Honor_fund.length;i++)
    {
    if(martyrs_Honor_fund[i]==event)
    {
    index=i;
    break;
    }
    }
    } 
    if(index==-1){
    for(var i=0;i<resource_development_tax.length;i++)
    {
    if(resource_development_tax[i]==event)
    {
    index=i;
    break;
    }
    }
    } 
    if(index==-1){
    for(var i=0;i<long_Live_egypt_fund.length;i++)
    {
    if(long_Live_egypt_fund[i]==event)
    {
    index=i;
    break;
    }
    }
    } 
    if(index==-1){
    for(var i=0;i<applied_tear.length;i++)
    {
    if(applied_tear[i]==event)
    {
    index=i;
    break;
    }
    }
    } 
    if(index==-1){
    for(var i=0;i<union_of_two_sayings.length;i++)
    {
    if(union_of_two_sayings[i]==event)
    {
    index=i;
    break;
    }
    }
    } 


   if(index != -1){
    if(actual_extract_values[index].value =="" || actual_extract_values[index].value ==0.0 ||actual_extract_values[index].value ==0 ){
    alert("ادخل قيمة المستخلص الفعلية الاول");
    return;
    }
   var percentage=Number(altaminats[index].value)+Number(workforces[index].value)+Number(Combined_discount_rates[index].value)+Number(bank_ratios[index].value)+
   Number(engineering_stamps[index].value)+Number(others[index].value)+Number(taxes[index].value)
   +Number(union_of_two_sayings[index].value)
   +Number(applied_tear[index].value)
   +Number(long_Live_egypt_fund[index].value)
   +Number(resource_development_tax[index].value)
   +Number(martyrs_Honor_fund[index].value)
   +Number(stamp_tax_division[index].value)
   +Number(value_added_tax[index].value)
   +Number(commercial_ndustrial_profits_tax[index].value)
   +Number(other_deductions_2[index].value)
   +Number(other_deductions_1[index].value)
   var total=Number(actual_extract_values[index].value)* percentage;

   price_mostakhlas_afters[index].value=Number(actual_extract_values[index].value)-Number((total/100));
   discount[index].value=Number(actual_extract_values[index].value)-Number(price_mostakhlas_afters[index].value)
   }

}

function addDurations(id) {
    // Assuming you have retrieved the values from form fields
    var durationDate1 = $('#durationDate1').val();
    var durationDate2 = $('#durationDate2').val();
    var durationDate3 = $('#durationDate3').val();
    var duration1 = $('#duration1').val();
    var duration2 = $('#duration2').val();
    var duration3 = $('#duration3').val();
    var csrfToken = $("input[name='csrfmiddlewaretoken']").val();
  
    var formData = {
        id: id, 
        durationDate1: durationDate1,
        durationDate2: durationDate2,
        durationDate3: durationDate3,
        duration1: duration1,
        duration2: duration2,
        duration3: duration3,
        csrfmiddlewaretoken: csrfToken
    };

  
    $.ajax({
        type: "POST",
        url: "/projects/add_duration/",
        data: formData,
        success: function(response) {
            var newRowHtml = '<tr>' +
    '<td>' + durationDate1 + '</td>' +
    '<td>' + durationDate2 + '</td>' +
    '<td>' +durationDate3 + '</td>' +
    '<td>' + duration1 + '</td>' +
    '<td>' + duration2 + '</td>' +
    '<td>' + duration3 + '</td>' +
    '</tr>';
$('#tableDurations').append(newRowHtml);
        },
        error: function(xhr, textStatus, errorThrown) {
           
            console.error("Error:", textStatus, errorThrown);
        }
    });
}
function addImported(id) {
    // Assuming you have retrieved the values from form fields
    var impSelect = $('#impSelect').val();
    var impCost = $('#impCost').val();
    var impDate = $('#impDate').val();
    var impNote = $('#impNote').val();
    
    var csrfToken = $("input[name='csrfmiddlewaretoken']").val();
    var formData = {
        id: id, 
        impSelect: impSelect,
        impCost: impCost,
        impDate: impDate,
        impNote: impNote,
        csrfmiddlewaretoken: csrfToken
    };

  
    $.ajax({
        type: "POST",
        url: "/projects/add_importeds/",
        data: formData,
        success: function(response) {
            var newRowHtml = '<tr>' +
    '<td>' + impSelect + '</td>' +
    '<td>' + impCost + '</td>' +
    '<td>' +impDate + '</td>' +
    '<td>' + impNote + '</td>' +
    '</tr>';
$('#tableImp').append(newRowHtml);
        },
        error: function(xhr, textStatus, errorThrown) {
           
            console.error("Error:", textStatus, errorThrown);
        }
    });
}
$(function(){
    $('#durationDate3').change(function() {
        var durationDate2 = $('#durationDate2').val();
        var durationDate3 = $('#durationDate3').val();
        var formattedDate2 = formatDate(durationDate2);
        var formattedDate3 = formatDate(durationDate3);
        var date2 = new Date(formattedDate2);
        var date3 = new Date(formattedDate3);

        // Check if the parsed dates are valid
        if (!isNaN(date2) && !isNaN(date3)) {
            // Calculate the difference in months
            var diffMonths = (date3.getFullYear() - date2.getFullYear()) * 12 + (date3.getMonth() - date2.getMonth());

            // Set the result in duration1
            $('#duration1').val(diffMonths);
        } else {
            // Handle invalid dates (e.g., display an error message)
            $('#duration1').val('Invalid dates');
        }
    });

    function formatDate(inputDate) {
        // Assuming inputDate is in the format "DD-MM-YYYY"
        var parts = inputDate.split("-");
        return parts[2] + "-" + parts[1] + "-" + parts[0];
    }
});


</script>
{% endblock extra_js %}